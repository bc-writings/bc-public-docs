% Source : http://tex.stackexchange.com/questions/34785/how-to-typeset-moon-phase-symbols

\documentclass[border=5mm]{standalone}
	\usepackage{tikz}
	\usetikzlibrary{calendar,fpu}

	\tikzset{
		moon colour/.style={
			moon fill/.style={
				fill=#1
			}
		},
		sky colour/.style={
			sky draw/.style={
				draw=#1
			},
			sky fill/.style={
				fill=#1
			}
		},
		southern hemisphere/.style={
			rotate=180
		}
	}

	\makeatletter
		\newcount\knownnewmoon
		\pgfcalendardatetojulian{2010-01-15}{\knownnewmoon} % 2010-01-15 07:11 UTC -- http://aa.usno.navy.mil/cgi-bin/aa_moonphases.pl?year=2010&ZZZ=END
		\newcount\inputdate
		\def\synodicmonth{29.530588853}
		\newcommand{\moon}[2][]{%
			\edef\checkfordate{\noexpand\in@{-}{#2}}%
			\checkfordate%
			\ifin@%
				\pgfcalendardatetojulian{#2}{\inputdate}%
				\pgfkeys{/pgf/fpu=true,/pgf/fpu/output format=fixed}%
				\pgfmathsetmacro\dayssincenewmoon{\the\inputdate-\the\knownnewmoon-(7/24+11/(24*60))}%
				\pgfkeys{/pgf/fpu=false}%
				\pgfmathsetmacro\lunarage{mod(\dayssincenewmoon,\synodicmonth)}%
			\else%
				\def\lunarage{#2}%
			\fi%
			\pgfmathsetmacro\leftside{ifthenelse(\lunarage<=\synodicmonth/2,cos(360*(\lunarage/\synodicmonth)),1)}%
			\pgfmathsetmacro\rightside{ifthenelse(\lunarage<=\synodicmonth/2,-1,-cos(360*(\lunarage/\synodicmonth))}%
			\tikz [moon colour=white,sky colour=black,#1]{
				\draw [moon fill, sky draw] (0,0) circle [radius=1ex];
				\draw [radius=1,sky draw, sky fill,y=1ex] (0,1ex)
					arc [x={(\rightside ex,0pt)},start angle=90,delta angle=-90]
					arc [x={(\rightside ex,0pt)},start angle=0,delta angle=-90]
					arc [x={(\leftside ex,0pt)},start angle=-90,delta angle=90]
					arc [x={(\leftside ex,0pt)},start angle=0,delta angle=90]
					-- cycle;
			}%
		}
	\makeatother

	\newcommand{\newmoon}{\moon{0}}
	\newcommand{\waxingcrescent}{\moon{3.5}}
	\newcommand{\firstquartermoon}{\moon{7}}
	\newcommand{\waxinggibbous}{\moon{10.5}}
	\newcommand{\fullmoon}{\moon{14}}
	\newcommand{\waninggibbous}{\moon{17.5}}
	\newcommand{\thirdquartermoon}{\moon{21}}
	\newcommand{\waningcrescent}{\moon{24.5}}


\begin{document}

\noindent\raggedleft%
\foreach \d in {0,2,...,30}{%
	\d: \moon{\d} \\
}


\moon[scale=10]{2011-11-20}


\moon[scale=10,sky colour=blue!50!black,moon colour=yellow,southern hemisphere]{2011-11-20}

\end{document}
