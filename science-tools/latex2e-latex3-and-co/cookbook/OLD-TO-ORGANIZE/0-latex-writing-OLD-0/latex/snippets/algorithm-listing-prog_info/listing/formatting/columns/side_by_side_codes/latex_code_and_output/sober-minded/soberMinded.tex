% Source : http://forum.mathematex.net/latex-f6/afficher-un-code-latex-et-son-rendu-cote-a-cote-t12327.html#p119486

\documentclass{article}
	\usepackage[utf8]{inputenc}
	\usepackage[T1]{fontenc}
	\usepackage{fancybox}
	\usepackage{xcolor}
	\usepackage{geometry}
	\usepackage{boites}

	\makeatletter
	\newcommand\make@car@active[2]{%
		\catcode`#1\active
		\begingroup
		\lccode`\~`#1\relax
		\lowercase{\endgroup\def~{#2}}}

	\newif\if@exstar
	\newif\if@shownumline
	\newcount\code@line
	\newcommand\shownumline{\@shownumlinetrue}
	\newcommand\hidenumline{\@shownumlinefalse}
	\hidenumline

	\newcommand\showcode{%
		\begingroup
		\parskip\z@\parindent\z@
		\code@line\z@
		\@makeother\;\@makeother\!\@makeother\?\@makeother\:
		\@ifstar{\@exstartrue\showcode@}{\@exstarfalse\showcode@}}

	\newcommand\showcode@[2][65]{%
		\medbreak\noindent
		\begingroup
			\let\do\@makeother\dospecials
			\make@car@active\ { {}}%
			\make@car@active\^^M{\par\leavevmode}%
			\make@car@active\,{\leavevmode\kern\z@\string,}%
			\make@car@active\-{\leavevmode\kern\z@\string-}%
			\showcode@@{#1}{#2}}

	\newcommand\showcode@@[3]{%
		\def\@tempa##1#3{\showcode@@@{#1}{#2}{##1}}%
		\@tempa}

	\newcommand\showcode@@@[3]{%
		\xdef\the@code{#3}%
		\endgroup
		\if@exstar
			\begingroup
				\fboxrule0.4pt
				\let\breakboxparindent\z@
				\def\bkvz@bottom{\hrule\@height\fboxrule}%
				\let\bkvz@before@breakbox\relax
				\def\bkvz@set@linewidth{\advance\linewidth\dimexpr-2\fboxrule-2\fboxsep}%
				\def\bkvz@left{\vrule\@width\fboxrule\hskip\fboxsep}%
				\def\bkvz@right{\hskip\fboxsep\vrule\@width\fboxrule}%
				\def\bkvz@top{\hbox to \hsize{%
					\vrule\@width\fboxrule\@height\fboxrule
					\leaders\bkvz@bottom\hfill
					\fboxsep\z@
					\colorbox{black}{\kern0.25em\bfseries\color{white}\footnotesize\lower0.5ex\hbox{\strut#2}\kern0.25em}%
					\leaders\bkvz@bottom\hfill
					\vrule\@width\fboxrule\@height\fboxrule}}%
				\breakbox
					\kern.5ex\relax
					\ttfamily\footnotesize
					\begingroup
					\if@shownumline\everypar{\num@code}\fi
					\the@code\par
					\endgroup
					\normalfont
					\kern3pt
					\hrule height0.1pt width\linewidth depth0.1pt
					\vskip5pt
					\rightskip0pt plus 1fill
					\newlinechar`\^^M\everyeof{\noexpand}\scantokens{#3}\par
				\endbreakbox
			\endgroup
		\else
			\vskip0.5ex
			\boxput*(0,1)
				{\fboxsep\z@
				\hbox{\colorbox{black}{\leavevmode\kern0.25em{\bfseries\color{white}\footnotesize\strut#2}\kern0.25em}}%
				}%
				{\fboxsep5pt
				\fbox{%
					$\vcenter{\hsize\dimexpr0.#1\linewidth-\fboxsep-\fboxrule\relax
						\kern5pt\parskip0pt \ttfamily\footnotesize
						\begingroup
							\if@shownumline\everypar{\num@code}\fi
							\the@code\par
						\endgroup}%
					\vcenter{\kern5pt\hsize\dimexpr\linewidth-0.#1\linewidth-\fboxsep-\fboxrule\relax
						\footnotesize\newlinechar`\^^M\everyeof{\noexpand}\scantokens{#3}}$%
					}%
				}%
		\fi
		\medbreak
		\endgroup}

	\newcommand\num@code{\hb@xt@4pt{\hss\global\advance\code@line\@ne\tiny\number\code@line}\kern3.5pt }
	\makeatother
	
	\usepackage[frenchb]{babel}


\begin{document}

Début du texte
\showcode{Un exemple par défaut}|Dans cet exemple, le partage entre
code et résultat se fait par défaut à 65\% de
la largeur du cadre qui est \verb-\linewidth-.

On peut définir des macros
\def\truc#1{Bonjour #1}% et mettre des commentaires
et les utiliser ensuite :

\truc{le monde} et \truc{toi}.|

\showcode[55]{Un exemple par défaut}|Dans cet exemple, le partage entre
code et résultat se fait à 55\% de
la largeur du cadre qui est \verb-\linewidth-.|

\showcode*{Un exemple étoilé par défaut}|Dans cet exemple où la macro \verb-\showcode- est étoilée, le partage entre code et résultat
se fait \textbf{verticalement}. En procédant de cette façon, le cadre peut passer les
coupures de pages.|

\shownumline
\showcode{Un exemple avec numéro de lignes}/En écrivant la macro \verb-\shownumline-,
les numéros de ligne apparaissent à gauche
du code. Pour revenir au comprtement par
défaut, il faut écrire \verb-\hidenumline-/
Suite du texte

\end{document}