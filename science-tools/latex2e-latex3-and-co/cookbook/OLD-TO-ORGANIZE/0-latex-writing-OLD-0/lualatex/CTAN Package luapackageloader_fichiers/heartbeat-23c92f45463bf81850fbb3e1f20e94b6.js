//# sourceMappingURL=heartbeat.js.map
/*
 2014-2018 Gerd Neugebauer
 @author <a href="gene@gerd-neugebauer.de">Gerd Neugebauer</a>
*/
var HeartBeat={_core:function(a){this.canvas=document.getElementById(a);this.context=a=this.canvas.getContext("2d");a.font="11px sans-serif";a.textBaseline="middle";a.textAlign="center";a.lineCap="round";a.lineJoin="round"}};
HeartBeat._core.prototype={canvas:void 0,context:void 0,minYear:Number.MAX_VALUE,minMon:12,maxValue:Number.MIN_VALUE,scaleHeight:0,plotData:[],mean:!1,today:new Date,colors:{outer:"#111",mid:"#555",scaleMid:"#666",text:"#fff",lines:"#999",data:"#fff",dataTop:"rgba(245,245,245,.95)",dataBottom:"rgba(96,96,96,.75)",mean:"rgba(255,255,255,.75)"},_tick:function(a,c,b){var d=this.context;d.beginPath();d.moveTo(a,c);d.lineTo(a,b);d.stroke()},_line:function(a,c,b,d){var e=this.context;e.beginPath();e.moveTo(a,
c);e.lineTo(b,d);e.stroke()},_bg:function(a){var c=this.canvas.height,b=a.createLinearGradient(0,0,0,c);b.addColorStop(0,this.colors.outer);b.addColorStop(.4,this.colors.mid);b.addColorStop(.5,this.colors.mid);b.addColorStop(.9,this.colors.outer);b.addColorStop(.95,this.colors.scaleMid);b.addColorStop(1,this.colors.outer);a.fillStyle=b;a.fillRect(0,0,this.canvas.width,c)},_x:function(a,c,b){var d=this.today.getYear()-this.epoch.getYear()+1-(this.epoch.getMonth()-1)/12;return.08*this.canvas.height+
this.scaleHeight+(new Date(a,c,b)-this.epoch)*(this.canvas.width-this.scaleHeight)/(31536E6*d)},data:function(a,c,b){b>this.maxValue&&(this.maxValue=b);a<this.minYear&&(this.minYear=a);a==this.minYear&&c<this.minMon&&(this.minMon=c);this.plotData.push([a,c,b]);return this},plotFrom:function(a){var c=this;c.draw();$.ajax({url:a,success:function(a){for(var d=0;d<a.length;d++){var e=a[d];c.data(e[0],e[1],e[2])}c.draw()},error:function(a,d,e){c.draw();console.log("error")}});return this},setColors:function(a){for(var c in a)this.colors[c]=
a[c];return this},lightColors:function(){this.colors={outer:"#ddd",mid:"#fff",scaleMid:"#eee",text:"#000",lines:"#aaa",data:"#111",dataTop:"rgba(200,200,200,.95)",dataBottom:"rgba(64,64,64,.75)",mean:"rgba(0,0,0,.75)"};return this},noColors:function(){this.colors={outer:"rgba(0,0,0,0)",mid:"rgba(0,0,0,0)",scaleMid:"rgba(0,0,0,0)",text:"#000",lines:"#aaa",data:"#111",dataTop:"rgba(0,0,0,0)",dataBottom:"rgba(0,0,0,0)",mean:"rgba(0,0,0,.75)"};return this},yMin:function(a){this.maxValue=a;return this}};
HeartBeat.Spectral=function(a){HeartBeat._core.call(this,a)};
HeartBeat.Spectral.prototype=Object.create(HeartBeat._core.prototype,{draw:{value:function(){this.epoch=new Date(this.minYear-1,this.minMon,1);var a=this.canvas.height,c=.9*a,b=this.context;this._bg(b);this._line(0,c,this.canvas.width,c);b.fillStyle=this.colors.text;b.strokeStyle=this.colors.lines;for(var d=.96*this.canvas.height,e=.99*this.canvas.height,h=.94*this.canvas.height,g=.92*this.canvas.height,f=this.epoch.getYear()+1900;f<=this.today.getYear()+1900;f++){this._tick(this._x(f,1,1),e,c);this._tick(this._x(f,
7,1),h,c);for(var k=2;12>=k;k++)this._tick(this._x(f,k,1),g,c);b.fillText(f,this._x(f,7,1),d)}b.strokeStyle=this.colors.data;for(b.lineWidth=3;0<this.plotData.length;)b=this.plotData.shift(),this._tick(this._x(b[0],b[1],b[2]),.2*a,c);return this}}});HeartBeat.Activity=function(a){HeartBeat._core.call(this,a)};
HeartBeat.Activity.prototype=Object.create(HeartBeat._core.prototype,{draw:{value:function(){var a=this.context,c=this.canvas.height;this.scaleHeight=.1*c;this._bg(a);var b=this.context.createLinearGradient(0,0,.2*c,0);b.addColorStop(0,this.colors.outer);b.addColorStop(.5,this.colors.scaleMid);b.addColorStop(1,this.colors.outer);a.fillStyle=b;a.fillRect(0,0,.2*c,.9*c);a.fillStyle=this.colors.outer;a.fillRect(0,.9*c,.2*c,c);a.strokeStyle=this.colors.lines;this._line(0,.9*c,this.canvas.width,.9*c);
if(0!=this.plotData.length){this.epoch=new Date(this.minYear,this.minMon,1);a.beginPath();a.moveTo(0,.9*c);a.fillStyle=this.colors.text;var d=50;1E4<this.maxValue?d=2500:4E3<this.maxValue?d=1E3:3E3<this.maxValue?d=500:2E3<this.maxValue?d=250:1E3<this.maxValue&&(d=100);for(b=d;b<this.maxValue+d;b+=d){var e=.9*c-.8*c*b/this.maxValue;a.lineWidth=0==b%(2*d)?1.25:.33;this._line(2*this.scaleHeight,e,this.canvas.width,e);0==b%100&&a.fillText(b,.1*c,e)}a.strokeStyle=this.colors.lines;a.lineWidth=.33;for(var d=
.96*c,b=.99*c,e=.92*c,h=.91*c,g=this.epoch.getYear()+1900;g<=this.today.getYear()+1900;g++){a.lineWidth=1.5;this._tick(this._x(g,1,1),0,b);a.lineWidth=.75;this._tick(this._x(g,7,1),0,e);a.lineWidth=.33;for(var f=2;12>=f;f++)this._tick(this._x(g,f,1),0,h);a.fillText(g,this._x(g,7,1),d)}d=[];b=this.plotData[0];e=this._x(b[0],b[1],15);a.beginPath();for(a.moveTo(e,.9*c);0<this.plotData.length;)b=this.plotData.shift(),e=this._x(b[0],b[1],15),b=.9*c-.8*c*b[2]/this.maxValue,d.push([e,b]),a.lineTo(e,b);a.lineTo(e,
.9*c);b=this.context.createLinearGradient(0,0,0,.9*c);b.addColorStop(0,this.colors.dataTop);b.addColorStop(.33,this.colors.dataTop);b.addColorStop(1,this.colors.dataBottom);a.fillStyle=b;a.fill();c=d.length;e=0;b=d.shift();a.beginPath();a.strokeStyle=this.colors.data;a.lineWidth=4;for(a.moveTo(b[0],b[1]);0<d.length;)b=d.shift(),a.lineTo(b[0],b[1]),e+=b[1];a.stroke();this.mean&&(e/=c,console.log(e),a.strokeStyle=this.colors.mean,a.lineWidth=4,this._line(this._x(this.minYear,1,1),e,this.canvas.width,
e));return this}}}});