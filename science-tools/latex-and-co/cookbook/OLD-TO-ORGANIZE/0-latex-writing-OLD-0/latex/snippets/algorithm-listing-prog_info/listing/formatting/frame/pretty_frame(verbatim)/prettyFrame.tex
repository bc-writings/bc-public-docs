% Source : http://forum.mathematex.net/latex-f6/un-probleme-avec-verbatim-t11259.html#p109458

\documentclass{article}
	\usepackage[T1]{fontenc}
	\usepackage[utf8]{inputenc}
	\usepackage[a4paper,margin=3cm]{geometry}
	\usepackage{fancyvrb}
	\usepackage{tikz}
	\usetikzlibrary{calc}
	\usepackage{xcolor}
	\usepackage[frenchb]{babel}

	\newenvironment{code}
		{\SaveVerbatim{VerbEnv}}
		{\endSaveVerbatim\parindent0pt
			\begin{tikzpicture}
				\node [fill=gray!10,rectangle,inner xsep=10pt,inner ysep=10pt] (box)
				{\begin{minipage}{\dimexpr\textwidth-21.66pt\relax}
				\UseVerbatim{VerbEnv}
				\end{minipage}
				};
				\node[text=white,fill=gray,rectangle, shading=ball, ball color=gray, above right] (title) at ($(box.north west)+(-0.03,0)$){\textbf{CODE}};
				\draw[color=gray!50!black,very thick] (box.north west)--(box.south west)--(box.south east);
			\end{tikzpicture}
		}


\begin{document}

\begin{code}
truc much $1=1$%
&=#% \relax
\end{code}

\end{document}
