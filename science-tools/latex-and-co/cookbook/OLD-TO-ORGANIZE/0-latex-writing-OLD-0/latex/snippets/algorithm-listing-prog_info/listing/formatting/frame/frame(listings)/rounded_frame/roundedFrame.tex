% Source : http://tex.stackexchange.com/questions/27673/background-overflows-when-using-rounded-corners-for-listings-package-listings

\documentclass[a4paper, 11pt]{article}
	\usepackage{listings}

	\lstset{%
		basicstyle=\footnotesize\ttfamily,
		abovecaptionskip=0pt,belowcaptionskip =0pt,
		framextopmargin=-\topsep, 
	}

% Define backgroundcolor

	\usepackage[style=1,skipbelow=\topskip,skipabove=\topskip]{mdframed}

	\definecolor{bggray}{rgb}{0.85, 0.85, 0.85}
	\mdfsetup{leftmargin=20pt,rightmargin=20pt,backgroundcolor=bggray,middlelinecolor=black,roundcorner=15}
	\BeforeBeginEnvironment{lstlisting}{\begin{mdframed}\vskip-.5\baselineskip}
	\AfterEndEnvironment{lstlisting}{\end{mdframed}}

% Only for testing ...
	\usepackage[english]{babel}
	\usepackage{blindtext}

\begin{document}
\blindtext
%
\begin{lstlisting}[caption=foo]
Foo {
    Bazzzzz 
}
Bar
\end{lstlisting}
%\lstcapt{Test}
%
\blindtext
%
\begin{lstlisting}
Foo

Foo {
    Bazzzzz 
}
Bar


Foo {
    Bazzzzz 
}
Bar


Foo {
    Bazzzzz 
}
Bar

Foo {
    Bazzzzz 
}
Bar

Foo {
    Bazzzzz 
}
Bar

Foo {
    Bazzzzz 
}
Bar
\end{lstlisting}

\blindtext

\lstlistoflistings

\end{document}
