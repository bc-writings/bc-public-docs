\usepackage{ifthen}           % Pour des tests SI-SINON-SI puissants.
\usepackage{tikz}
\usepackage[svgnames]{xcolor} % Pour la couleur ForestGreen.

%%%
% Le travail de calcul modulo `2` est fait par la fonction ''binCnp''
% présente dans le fichier ''main.lua''.
%%%

% Importation du fichier ''main.lua''.
\directlua{dofile('main.lua')}

%%%
% prototype::
%     #1 : le "naturel" n du nombre de combinaisons de p parmi n.
%     #2 : le "naturel" p du nombre de combinaisons de p parmi n.
%%%
\NewDocumentCommand{\binCnp}{mm}{%
  \directlua{tex.sprint(binCnp(#1, #2))}%
}


\tikzset{
  cnp/.style n args={1}{
    draw,
    rectangle,
    minimum size = 2.3em,
    color        = #1!70!black,
    fill         = #1!70!black, % Juste du design visuel.
  }
}


%%%
% prototype::
%     #1 : le nombre de lignes souhaitées.
%%%
\NewDocumentCommand{\discretsierpinsky}{O{black}R<>{black}m}{%
  \begin{tikzpicture}[scale = 0.8]
    \foreach \n in {0,...,#3} {
      \pgfmathsetmacro\pshift{0.5 * \n}

      \foreach \p in {0,...,\n} {
        \ifthenelse{\binCnp{\n}{\p} = 1}{
          \colorlet{col}{#1}
        }{
          \colorlet{col}{#2}
        }

        \draw (\p - \pshift, 6 - \n) node[cnp = col] {};
      }
    }
  \end{tikzpicture}
}
