% !TEX TS-program = lualatex

\documentclass[border = 3pt]{standalone}

\usepackage[svgnames]{xcolor}
\usepackage[3d]{luadraw}

\directlua{dofile('main.lua')}

\begin{document}

\begin{luadraw}{name = matrix-kernel-transfo-auto-2}
------
-- Les données.
------
local dist = 3.5

-- Cellule suivie des dimensions.
local focus_in = { {1, 4}, {1, 5} }

local mat_in = {
  { 1,  2,  3,  4,  5,  1,  2,  3,  4,  5},
  { 6,  7,  8,  9,  0,  6,  7,  8,  9,  0},
  {-1, -2, -3, -4, -5, -1, -2, -3, -4, -5},
  {-6, -7, -8, -9,  0, -6, -7, -8, -9,  0},
}

local transfo = function(Mat)
  local NewMat  = {}
  local nb_rows = #Mat
  local nb_cols = #Mat[1]

  for i = 1, nb_rows - 1 do
    NewMat[i] = {}

    for j = 1, nb_cols - 1 do
      NewMat[i][j] = Mat[i][j] + Mat[i][j+1] - Mat[i+1][j] - Mat[i+1][j+1]
    end
  end

  return NewMat
end

------
-- Le tracé.
------
local mat_out = transfo(mat_in)

local win3d = matkernel_getbbox3d(dist, mat_in, mat_out)

local graphview = graph3d:new{
  window3d = win3d,
  adjust2d = true,
  bbox     = false,
  viewdir  = {40, 60}
}

graphview:Dmatkernel(
  dist,
  mat_in, mat_out,
  focus_in
)

graphview:Show()
\end{luadraw}

\end{document}
