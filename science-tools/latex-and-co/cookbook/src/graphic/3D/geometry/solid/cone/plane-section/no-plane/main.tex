% !TEX TS-program = lualatex

%%%
% src::
%     url = https://tex.stackexchange.com/a/748102
%%%

\documentclass{standalone}

%%%
% Des couleurs faciles d'emploi via le package ''xcolor''!
%%%
\usepackage[svgnames]{xcolor}

%%%
% La bibliothèque ''luadraw'' allie une facilité d’utilisation à
% un rendu particulièrement soigné.
%%%
\usepackage[3d]{luadraw}

%%%
% Nous définissons deux nouvelles couleurs.
%%%

\colorlet{coneCol}{blue!50!black!75}
\colorlet{sideCol}{blue!75!black}

\begin{document}

\begin{luadraw}{name = hyperbola-section}
------
-- Quelques variables bien nommées pour un usage local.
------
local height      =  5
local radius      =  3
local vec_cone    = height*vecK
local width_line  =  16
local section_col = "red"
local cone_col    = "coneCol"
local side_col    = "sideCol"

------
-- ¨Def de la zone graphique.
--
--     1) La fenêtre ''window'' est un objet 2D relatif au plan de
--     projection calculé par latex::''luadraw''.
--
--     1) ''viewdir'' permet de définir les deux angles de vue (en
--     degrés) pour la projection orthographique.
--
--     1) ''size'' impose les dimensions en cm dans le document.
------
local graphview = graph3d:new{
  window  = {-radius - 1, radius + 1, -height - 1, height + 1},
  viewdir = {120, 60},
  size    = {12, 12}
}

------
-- Nous changeons l'épaisseur et la couleur des lignes.
------
graphview:Lineoptions(solid, side_col, width_line)

------
-- Nous changeons la valeur de ''Hiddenlinestyle'' qui par défaut
-- vaut ''"dotted"''.
------
Hiddenlinestyle = "dashed"

------
-- Nous définissons des polyèdres de type conique pour calculer des
-- sections planes juste après. Attention, car nous ne définissons
-- pas une surface conique de révolution de hauteur "infinie", et
-- nous ne pourrons pas effectuer de tracés à partir des solides
-- coniques définis ci-après. Voici les paramètres fournis.
--
--     1) Tout d'abord, il faut donner le sommet du cône.
--
--     1) Vient ensuite un vecteur directeur permettant de définir
--     à partir du sommet le demi-axe orienté du solide conique.
--
--     1) Il est possible de changer le nombre de facettes pour le
--     tracé. Ce paramètre agit sur le calcul de la section avec le
--     plan : pour voir ce que cela signifie, changer `100' en `3'.
--
--
-- note::
--     Via une quatrième valeur booléenne ''true'', il est possible
--     d'ouvrir les cônes. Nous utilisons ceci dans la recette
--     suivante.
------
local cone_1 = cone(
  Origin, vec_cone, radius,
  100
)

local cone_2 = cone(
  Origin,  -vec_cone, radius,
  100
)

------
-- Le plan de coupe est modélisé par un tableau contenant un point
-- et un vecteur normal, puis nous calculons les intersections de
-- ce "plan" avec nos deux solides coniques : nous obtenons des
-- lignes polygonales, et non des surfaces planes.
------
local plane     = {M(1, 0, 0), vecI}
local section_1 = graphview:Intersection3d(cone_1, plane)
local section_2 = graphview:Intersection3d(cone_2, plane)

------
-- Le tracé des solides coniques se fait indépendamment des calculs
-- effectués ci-dessus : autrement dit, nous ne pouvons pas nous
-- appuyer sur les variables ''cone_1'' et ''cone_2''.
------
graphview:Dcone(
  Origin, vec_cone, radius,
  {
    color = cone_col
  })

graphview:Dcone(
  Origin, -vec_cone, radius,
  {
    color = cone_col
  })

------
-- Nous traçons les bords des sections calculées plus haut tout en
-- affichant les lignes cachées via ''hidden = true''.
------
graphview:Dedges(
  section_1,
  {
    hidden = true,
    color = section_col
  })

graphview:Dedges(
  section_2,
  {
    hidden = true,
    color = section_col
  })

------
-- Et le merveilleux se révèle au monde.
------
graphview:Show()
\end{luadraw}

\end{document}
