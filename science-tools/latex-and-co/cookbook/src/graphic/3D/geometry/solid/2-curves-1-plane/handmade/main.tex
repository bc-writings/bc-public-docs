% !TEX TS-program = lualatex

%%%
% src::
%     url = https://tex.stackexchange.com/a/750101
%%%

\documentclass{standalone}

%%%
% Des couleurs faciles d'emploi via le package ''xcolor''!
%%%
\usepackage[svgnames]{xcolor}

%%%
% La bibliothèque ''luadraw'' allie une facilité d’utilisation à
% un rendu particulièrement soigné.
%%%
\usepackage[3d]{luadraw}

\begin{document}

\begin{luadraw}{name = 2-curves-1-plane}
------
-- Éléments constitutifs de notre solide.
--
--     1) Deux paraboles pour la base du cylindre vertical.
--
--     1) Un plan pour biseauter le cylindre.
------
local f = function(x)
  return 3*x^2 - 1
end

local g = function(x)
  return 3 - x^2
end

local P = planeEqn(1, 1, 1, -4)

------
-- ¨Def de la zone graphique.
------
local graphview = graph3d:new{
  window3d = {-2, 2, -2, 3, 0, 8},
  adjust2d = true,
  viewdir  = {-30, 50},
  size   = {12, 12, 0}
}

------
-- Réglage du repère en mode "boîte".
------
graphview:Dboxaxes3d({
  grid      = true,
  gridcolor = "gray",
  fillcolor = "LightGray"
})

------
-- Construction du domaine dans le plan `xOy`.
--
--     1) La fonction ''map'' sert à appliquer ''toPoint3d'' à chaque
--     élément d'une liste de réels, ou de complexes, pour les
--     convertir en point 3D.
--
--     1) Quant à la méthode ''domain3'', elle permet de définir le
--     contour délimité par les courbes des fonctions `f` et `g` avec
--     des réglages expliqués en commentaires.
------
local xOy_domain = map(
  toPoint3d,
  domain3(
    f, g,   -- Deux courbes pour le domaine.
    -3, 3,  -- Intervalle de définition [-3; 3]
    50,     -- Nombre de points utilisés.
    false,  -- Pas de discontinuité.
    0       -- Aucune subdivision adaptative des calculs
            -- intérmédiaires, car ceci indique combien de
            -- fois, au maximum, une étape de calcul peut
            -- être divisée en deux (par dichotomie).
  )
)

------
-- Construction du domaine dans le plan `P`: nous avons juste à
-- projeter la base du cylindre dans le plan `P`.
------
local P_domain = proj3dO(xOy_domain, P, vecK)

------
-- Construction d'une liste de faces latérales polygonales (ce choix
-- de design améliore la compréhension de l'objet).
--
-- note::
--     ''#xOy_domain'' est la taille de la liste ''xOy_domain''.
------
local lateral, facet, n = {}, {}, #xOy_domain

for k = 1, n do
  local j

  if k == n then
    j = 1
  else
    j = k + 1
  end

  facet = {
    xOy_domain[k], xOy_domain[j],
    P_domain[j]  , P_domain[k]
  }

  table.insert(lateral, facet)
end

------
-- Tracé du domaine dans le plan `xOy` en hachuré et sans bordure.
------
graphview:Filloptions("fdiag", "ForestGreen")
graphview:Linestyle("noline")
graphview:Dpolyline3d(xOy_domain, true)

------
-- Pour ce qui suit, nous ne remplissions plus rien, et utilisons de
-- nouveau des traits pleins.
------
graphview:Filloptions("none")
graphview:Linestyle("solid")

------
-- Nous nous plaçons dans le plan `xOy` pour y tracer les courbes des
-- fonctions  `f` et `g`. La technique employée est similiare à ce qui
-- se fait avec ¨opengl: nous jouons avec des matrices de vue.
------
graphview:Savematrix()
  graphview:Setmatrix(
    graphview:Proj3d({Origin, vecI, vecJ})
  )

  graphview:Dcartesian(
    f,
    {
      x = {-2/math.sqrt(3), 2/math.sqrt(3)},
      draw_options = "line width = 0.8pt, Navy"
    }
  )

  graphview:Dcartesian(
    g,
    {
      x = {-2, 2},
      draw_options = "line width = 0.8pt, Crimson"
    }
  )
graphview:Restorematrix()

------
-- Tracé des faces latérales.
------
graphview:Dfacet(
  lateral,
  {
    edgecolor = "gray",
    edgewidth = 2,
    color   = "Pink",
    opacity   = 0.3
  }
)

------
-- Tracé du domaine dans le plan `P`.
------
graphview:Dpolyline3d(
  P_domain,
  true,
  "draw = none, fill = cyan, fill opacity = 0.8"
)

------
-- Pour visualiser le plan `P` dans le repère de type "boîte".
------
graphview:Dpolyline3d(
  graphview:Plane2facet(P),
  true,   -- Pour fermer la ligne.
  "cyan"
)

------
-- Et le merveilleux se révèle au monde.
------
graphview:Show()
\end{luadraw}

\end{document}
