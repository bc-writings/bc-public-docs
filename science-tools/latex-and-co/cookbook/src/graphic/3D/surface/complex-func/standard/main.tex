% !TEX TS-program = lualatex

%%%
% src::
%     url = https://tex.stackexchange.com/a/751587/6880
%%%

\documentclass{standalone}

%%%
% Des couleurs faciles d'emploi via le package ''xcolor''!
%%%
\usepackage[svgnames]{xcolor}

%%%
% La bibliothèque ''luadraw'' allie une facilité d’utilisation à
% un rendu particulièrement soigné.
%%%
\usepackage[3d]{luadraw}

\begin{document}

\begin{luadraw}{name = gamma-modulus-surface}
------
-- Le ¨calc de `gamma(z)` est fait via la formule suivante :
-- `gamma(z) = sum(k, 0, +oo, (-1)^k / {k! (z + k)}
--           + integral(t, 1, +oo, t^{z - 1} ee^{-t})`
------
local gamma = function(x, y)
  local k_facto, sign, z = 1, 1, Z(x, y)

  local S = 1 / z

  for k = 1, 50 do
    sign    = -sign
    k_facto = k_facto*k

    S = S + sign / k_facto / (z + k)
  end

  return S + int(
    function(t)
      return cpx.exp((z - 1)*math.log(t) - t)
    end,
    1, 10
  )
end

------
-- Paramétrisation de la ¨surf "complexe".
------
local gamma_modulus_pt = function(x, y)
  local gz = gamma(x, y)

  if gz ~= nil then
    return M(x, y, cpx.abs(gz))
  end
end

------
-- Coloration en ¨fonc de l'¨arg principal du complexe `gamma(z)`.
------
local spectrum = {Cyan, DodgerBlue, Magenta, Red, Orange, Gold, LimeGreen}

local color_coef = function(G)
  local gz = gamma(G.x, G.y)

  if gz ~=  nil then
    return (cpx.arg(gz) + math.pi) / (2*math.pi)
  end
end

------
-- ¨Def de la zone graphique.
------
local graphview = graph3d:new{
  window3d = {-4, 5, -5, 5, 0, 6},
  adjust2d = true,
  size     = {10, 10},
  viewdir  = {-120, 60}
}

------
-- ¨Def de la ¨surf contenue dans le demi-plan `z <= 6`.
------
local cpx_surf = surface(
  gamma_modulus_pt,
  -4, 5, -5, 5,
  {50, 50})

cpx_surf = cutfacet(
  cpx_surf,
  {6*vecK, -vecK})

cpx_surf = graphview:Sortfacet(cpx_surf)

------
-- Boîte graduée.
------
graphview:Dboxaxes3d({
  grid      = true,
  gridcolor = "gray",
  fillcolor = "LightGray"
})

------
-- Tracé de la ¨surf facette par facette.
------
for _ , facet in ipairs(cpx_surf) do
  graphview:Dpolyline3d(
    facet,
    true,
       "very thin, fill = "
    .. palette(spectrum, color_coef(isobar3d(facet)))
  )
end

------
-- Et le merveilleux se révèle au monde.
------
graphview:Show()
\end{luadraw}

\end{document}
