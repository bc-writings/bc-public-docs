% !TEX TS-program = lualatex

%%%
% src::
%     url = https://github.com/pfradin/luadraw/discussions/148#discussioncomment-14980822
%%%

\documentclass[border = 3pt]{standalone}

\usepackage[svgnames]{xcolor}
\usepackage[3d]{luadraw}

\begin{document}

\begin{luadraw}{name = central-proj-of-cube-artistic}
require 'luadraw_polyhedrons'

local z0    = -3
local light = M(-5, -5, 3.5)

local center = M(-1, -1, -1)

local proj = function(A)
  return proj3dO(A, {z0*vecK, vecK}, A-light)
end

local graphview = graph3d:new{
  window3d = {-5, 8, -5, 7, z0, 5},
  adjust2d = true, bbox = false,
  viewdir  = perspective("yz", 0.35, 60),
  size     = {10, 10}
}

graphview:Linewidth(6)
Hiddenlinestyle = "dotted"
Hiddenlines     = true

local P = cube(center, M(-1, -0.5, z0+.2))

local shadow = cvx_hull3d(
  ftransform3d(P.vertices, proj)
)[1]

local beam = pyramid(reverse(shadow), light, true)

local beamVisble, beamHidden = graphview:Classifyfacet(beam)

graphview:Dfacet(
  graphview:Plane2facet({z0*vecK, vecK}),
  {
    color    = "lightgray",
    contrast = 0
  }
)

graphview:Dseg3d({M(-5, -5, z0), light})

graphview:Dballdots3d(light, "Yellow", 2)

graphview:Dpolyline3d(
  shadow,
  true,
  "draw = none, fill = DarkGray, fill opacity = 0.9"
)

graphview:Dfacet(
  beamHidden,
  {
    color   = "yellow",
    opacity = 0.4,
    mode    = mShadedOnly
  }
)

graphview:Dpoly(
  P,
  {
    color = "cyan",
    mode  = mShadedHidden
  }
)

graphview:Dfacet(
  beamVisble,
  {
    color   = "yellow",
    opacity = 0.4,
    mode    = mShadedOnly
  }
)

graphview:Show()
\end{luadraw}

\end{document}
